Функция ПолучитьТекстЗапросаХарактеристики(КомпонентыОбмена, НаименованиеИсточника)
	ТекстЗапроса = "&Источник.Характеристика КАК ХарактеристикаСсылка";
	
	Если ВерсияФорматаЧислом(КомпонентыОбмена.ВерсияФорматаОбмена) >= ВерсияФорматаЧислом("1.7") Тогда
		ТекстЗапроса = ТекстЗапроса + ",
		    |	НЕ ЕСТЬNULL(&Источник.Характеристика.Владелец.ИспользованиеХарактеристик, ЗНАЧЕНИЕ(Перечисление.ВариантыИспользованияХарактеристикНоменклатуры.ОбщиеСДругимВидомНоменклатуры)) = ЗНАЧЕНИЕ(Перечисление.ВариантыИспользованияХарактеристикНоменклатуры.ОбщиеСДругимВидомНоменклатуры) КАК ХарактеристикаСоответствуетФормату,
		    |	ЕСТЬNULL(&Источник.Номенклатура.ВидНоменклатуры, Значение(Справочник.ВидыНоменклатуры.ПустаяСсылка)) КАК ХарактеристикаВладелец,
			|	&Источник.Характеристика.Наименование КАК ХарактеристикаНаименование,
			|	&Источник.Характеристика.НаименованиеПолное КАК ХарактеристикаНаименованиеПолное";
	ИначеЕсли ВерсияФорматаЧислом(КомпонентыОбмена.ВерсияФорматаОбмена) = ВерсияФорматаЧислом("1.6") Тогда
		ТекстЗапроса = ТекстЗапроса + ",
		    |	ЕСТЬNULL(&Источник.Характеристика.Владелец, ЗНАЧЕНИЕ(Справочник.ВидыНоменклатуры.ПустаяСсылка)) ССЫЛКА Справочник.Номенклатура КАК ХарактеристикаСоответствуетФормату,
		    |	&Источник.Номенклатура КАК ХарактеристикаВладелец,
			|	&Источник.Характеристика.Наименование КАК ХарактеристикаНаименование,
			|	&Источник.Характеристика.НаименованиеПолное КАК ХарактеристикаНаименованиеПолное";
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Источник", НаименованиеИсточника);
	
	Возврат ТекстЗапроса;
КонецФункции
