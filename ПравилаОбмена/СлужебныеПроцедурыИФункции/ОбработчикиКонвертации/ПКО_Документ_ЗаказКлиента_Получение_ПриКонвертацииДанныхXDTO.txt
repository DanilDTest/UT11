Процедура ПКО_Документ_ЗаказКлиента_Получение_ПриКонвертацииДанныхXDTO(ДанныеXDTO, ПолученныеДанные, КомпонентыОбмена)
	ДатаРезерва = Неопределено;
	ДанныеXDTO.Свойство("RM_ДатаРезерва", ДатаРезерва);
	ПолученныеДанные.ДополнительныеСвойства.Вставить("ДатаРезерва", ДатаРезерва);
	
	
	ПравилаЗаполненияТовары = Новый Соответствие;
	ПравилаЗаполненияТовары.Вставить("Номенклатура",				"Номенклатура");
	ПравилаЗаполненияТовары.Вставить("Характеристика",				"Характеристика");
	ПравилаЗаполненияТовары.Вставить("Количество",					"Количество");
	ПравилаЗаполненияТовары.Вставить("КоличествоУпаковок",			"КоличествоУпаковок");
	ПравилаЗаполненияТовары.Вставить("Упаковка",					"Упаковка");
	ПравилаЗаполненияТовары.Вставить("Цена",						"Цена");
	ПравилаЗаполненияТовары.Вставить("Сумма",						"Сумма");
	ПравилаЗаполненияТовары.Вставить("СуммаНДС",					"СуммаНДС");
	ПравилаЗаполненияТовары.Вставить("СтавкаНДС",					"СтавкаНДС");
	ПравилаЗаполненияТовары.Вставить("Отменено",					"Отменено");
	ПравилаЗаполненияТовары.Вставить("ПричинаОтмены",				"ПричинаОтмены");
	ПравилаЗаполненияТовары.Вставить("ВариантОбеспечения",			"ВариантОбеспечения"); 
	ПравилаЗаполненияТовары.Вставить("ПроцентАвтоматическойСкидки",	"ПроцентАвтоматическойСкидки");
	ПравилаЗаполненияТовары.Вставить("ПроцентРучнойСкидки",			"ПроцентРучнойСкидки");
	ПравилаЗаполненияТовары.Вставить("СуммаРучнойСкидки",			"СуммаРучнойСкидки");
	ПравилаЗаполненияТовары.Вставить("СуммаАвтоматическойСкидки",	"СуммаАвтоматическойСкидки");  
	ПравилаЗаполненияТовары.Вставить("ОтменаСогласованаКлиентом",	"RM_ОтменаСогласованаСПокупателем");
	ПравилаЗаполненияТовары.Вставить("Зарезервировано",				"Зарезервировано"); 
	ПравилаЗаполненияТовары.Вставить("КлючСвязи",					"КлючСвязи");
	ПравилаЗаполненияТовары.Вставить("КодСтроки",					"КодСтроки");
	ПравилаЗаполненияТовары.Вставить("ИдентификаторТовараСтрокой",	"RM_ИдентификаторТовараСтрокой");
	ПравилаЗаполненияТовары.Вставить("ДоставкаНомерОтправления",	"RM_НомерОтправленияOZON");
	ПравилаЗаполненияТовары.Вставить("ДоставкаНаименованиеТовара",	"RM_НаименованиеТовараOZON");
	ПравилаЗаполненияТовары.Вставить("ДоставкаИдентификаторТовара",	"RM_ИдентификаторТовараВСистемеOzon");
	
	
	
	// Товары 
	МассивСтрокТовары = Новый Массив;
	Если ДанныеXDTO.Свойство("Товары")
		И ЗначениеЗаполнено(ДанныеXDTO.Товары) Тогда
		
		Для Каждого Строка Из ДанныеXDTO.Товары Цикл
			СтруктураДанныхСтроки = ДанныеКоллекцииВВидеСтруктуры(Строка, ПравилаЗаполненияТовары);
			СуммаСНДС = Строка.Сумма;
			
			СтруктураДанныхСтроки.Вставить("СуммаСНДС", СуммаСНДС);
			Если СтруктураДанныхСтроки.Свойство("КоличествоУпаковок") Тогда
			    Если СтруктураДанныхСтроки.Свойство("Упаковка") И СтруктураДанныхСтроки.Свойство("Сумма") Тогда
					СтруктураДанныхСтроки.Вставить("Цена", СтруктураДанныхСтроки.Сумма / СтруктураДанныхСтроки.КоличествоУпаковок);
				КонецЕсли;
			Иначе
				СтруктураДанныхСтроки.Вставить("КоличествоУпаковок", СтруктураДанныхСтроки.Количество);
			КонецЕсли;   
			
			Если Не СтруктураДанныхСтроки.Свойство("ВариантОбеспечения")
				Или НЕ ЗначениеЗаполнено(СтруктураДанныхСтроки.ВариантОбеспечения) Тогда
				Если СтруктураДанныхСтроки.Свойство("Зарезервировано") Тогда
					Обеспечение = ?(СтруктураДанныхСтроки.Зарезервировано = Истина, Перечисления.ВариантыОбеспечения.Отгрузить, Перечисления.ВариантыОбеспечения.Требуется);
					СтруктураДанныхСтроки.Вставить("ВариантОбеспечения", Обеспечение);	
				Иначе     
				   	СтруктураДанныхСтроки.Вставить("ВариантОбеспечения", Перечисления.ВариантыОбеспечения.Требуется);	
				КонецЕсли;
			КонецЕсли;
			
	
			МассивСтрокТовары.Добавить(СтруктураДанныхСтроки);
		КонецЦикла;
	КонецЕсли;
	
	// Услуги  загружаются в ТЧ Товары.
	Если ДанныеXDTO.Свойство("Услуги")
		И ЗначениеЗаполнено(ДанныеXDTO.Услуги) Тогда
	    
	    ПравилаЗаполненияУслуги = Новый Соответствие;
		ПравилаЗаполненияУслуги.Вставить("Номенклатура",				"Номенклатура");
		ПравилаЗаполненияУслуги.Вставить("Количество",					"Количество");
		ПравилаЗаполненияУслуги.Вставить("Сумма",						"Сумма");
		ПравилаЗаполненияУслуги.Вставить("Цена",						"Цена");
		ПравилаЗаполненияУслуги.Вставить("СтавкаНДС",					"СтавкаНДС");
		ПравилаЗаполненияУслуги.Вставить("СуммаНДС",					"СуммаНДС");
		ПравилаЗаполненияУслуги.Вставить("Характеристика",				"Характеристика");
		ПравилаЗаполненияУслуги.Вставить("Упаковка",					"Упаковка");
		ПравилаЗаполненияУслуги.Вставить("КоличествоУпаковок",			"КоличествоУпаковок");
		ПравилаЗаполненияУслуги.Вставить("Отменено",					"Отменено");
		ПравилаЗаполненияУслуги.Вставить("ПричинаОтмены",				"ПричинаОтмены");   
		ПравилаЗаполненияУслуги.Вставить("ОтменаСогласованаКлиентом",	"RM_ОтменаСогласованаСПокупателем" );
		ПравилаЗаполненияУслуги.Вставить("Зарезервировано",				"RM_Зарезервировано");
		ПравилаЗаполненияУслуги.Вставить("КлючСвязи",					"КлючСвязи");
		ПравилаЗаполненияУслуги.Вставить("КодСтроки",					"КодСтроки");
	    
		Для Каждого Строка Из ДанныеXDTO.Услуги Цикл
			СтруктураДанныхСтроки = ДанныеКоллекцииВВидеСтруктуры(Строка, ПравилаЗаполненияУслуги);
	        
	        СуммаСНДС = СтруктураДанныхСтроки.Сумма;
			Если СтруктураДанныхСтроки.Свойство("СуммаНДС") И НЕ ПолученныеДанные.ЦенаВключаетНДС Тогда
				СуммаСНДС = СуммаСНДС + СтруктураДанныхСтроки.СуммаНДС
			КонецЕсли;
			
			СтруктураДанныхСтроки.Вставить("СуммаСНДС", СуммаСНДС);
			
			Если СтруктураДанныхСтроки.Свойство("КоличествоУпаковок") Тогда
			    Если СтруктураДанныхСтроки.Свойство("Упаковка") И СтруктураДанныхСтроки.Свойство("Сумма") Тогда
					СтруктураДанныхСтроки.Вставить("Цена", СтруктураДанныхСтроки.Сумма / СтруктураДанныхСтроки.КоличествоУпаковок);
				КонецЕсли;
			Иначе
				СтруктураДанныхСтроки.Вставить("КоличествоУпаковок", СтруктураДанныхСтроки.Количество);
			КонецЕсли;
			
			МассивСтрокТовары.Добавить(СтруктураДанныхСтроки);
		КонецЦикла;
		
	КонецЕсли;
	        
	
	ПолученныеДанные.ДополнительныеСвойства.Вставить("Товары", МассивСтрокТовары);     
	
	Если ДанныеXDTO.Свойство("ОсновнаяПричинаОтмены") Тогда
		ПолученныеДанные.ДополнительныеСвойства.Вставить("ОсновнаяПричинаОтмены", ДанныеXDTO.ОсновнаяПричинаОтмены);    
	КонецЕсли;
КонецПроцедуры
