Процедура ПКО_Справочник_СостояниеОплатыЗаказа_Отправка_ПриОтправкеДанных(ДанныеИБ, ДанныеXDTO, КомпонентыОбмена, СтекВыгрузки)
	Заказ = ДанныеИБ.Отбор.Заказ.Значение;
	ДанныеXDTO.КлючевыеСвойства.Вставить("Заказ", Заказ);
	
	ТаблицаЗаписи = ДанныеИБ.Выгрузить();
	
	ДанныеXDTO.Вставить("ДатаСостояния",     ТаблицаЗаписи[0].ДатаСобытия);
	ДанныеXDTO.Вставить("СуммаВсехПлатежей", ТаблицаЗаписи[0].СуммаОплаты);
	
	Если ТаблицаЗаписи[0].ПроцентОплаты = 100 Тогда
		СостояниеОплаты = "Оплачен";
	ИначеЕсли ЗаказОтменен(Заказ) Тогда
		СостояниеОплаты = "Отменен";
	ИначеЕсли ТаблицаЗаписи[0].ПроцентОплаты > 0 Тогда
		СостояниеОплаты = "ОплаченЧастично";
	Иначе
		СостояниеОплаты = "НеОплачен";
	КонецЕсли;	
	
	ДанныеXDTO.Вставить("СостояниеОплаты", СостояниеОплаты);
КонецПроцедуры
