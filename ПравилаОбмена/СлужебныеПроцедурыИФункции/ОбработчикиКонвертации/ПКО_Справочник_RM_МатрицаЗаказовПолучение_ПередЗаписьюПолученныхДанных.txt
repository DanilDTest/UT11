Процедура ПКО_Справочник_RM_МатрицаЗаказовПолучение_ПередЗаписьюПолученныхДанных(ПолученныеДанные, ДанныеИБ, КонвертацияСвойств, КомпонентыОбмена)
	Справочник_Номенклатура_Получение = RM_ОбменДаннымиXDTOСервер.ПКОПоИмени(КомпонентыОбмена,"Справочник_Номенклатура_Получение");
	Справочник_Склады_Получение = RM_ОбменДаннымиXDTOСервер.ПКОПоИмени(КомпонентыОбмена,"Справочник_Склады_Получение");   
	Справочник_Пользователи = RM_ОбменДаннымиXDTOСервер.ПКОПоИмени(КомпонентыОбмена,"Справочник_Пользователи");
	
	
	СтруктураИзмеренийРегистра = Новый Структура;
	СтруктураИзмеренийРегистра.Вставить("Номенклатура");    
	СтруктураИзмеренийРегистра.Вставить("Склад");
	                                               
	                                               
	                                               
	Для каждого ИзмерениеРегистра из СтруктураИзмеренийРегистра Цикл         
	
		Измерение = ИзмерениеРегистра.Ключ;
		Значение = ПолученныеДанные.ДополнительныеСвойства[Измерение];
		
		Если Значение = Неопределено Тогда
			Продолжить;
		ИначеЕсли ТипЗнч(Значение) = Тип("Структура") Тогда
			
			Если ИзмерениеРегистра.Ключ = "Номенклатура" Тогда
				ПКО = Справочник_Номенклатура_Получение;      
			ИначеЕсли ИзмерениеРегистра.Ключ = "Склад" Тогда
	            ПКО = Справочник_Склады_Получение;
			КонецЕсли;
			
			Значение = RM_ОбменДаннымиXDTOСервер.СтруктураОбъектаXDTOВДанныеИБ(КомпонентыОбмена, 
				Значение, 
				ПКО, 
				"ПолучитьСсылку").Ссылка;		
		КонецЕсли;
	
		 ПолученныеДанные.Отбор[Измерение].Значение = Значение;
		 ПолученныеДанные.Отбор[Измерение].Использование = ?(Измерение = "Период", Истина, ЗначениеЗаполнено(ПолученныеДанные.Отбор[Измерение].Значение));
	КонецЦикла;
	       
	СтруктураСсылочныхПолей = СтруктураИзмеренийРегистра;
	СтруктураИзмеренийРегистра.Вставить("Номенклатура");    
	СтруктураИзмеренийРегистра.Вставить("Склад");
	СтруктураИзмеренийРегистра.Вставить("Ответственный");      
		
	// Добавление записей в набор записей.		
	Если ПолученныеДанные.ДополнительныеСвойства.Записи <> Неопределено Тогда
		
		Для Каждого Запись Из ПолученныеДанные.ДополнительныеСвойства.Записи Цикл
			
			СтрокаЗаписи          = ПолученныеДанные.Добавить();  
			ЗаполнитьЗначенияСвойств(СтрокаЗаписи, Запись);	
							
			Для каждого ИзмерениеРегистра из СтруктураСсылочныхПолей Цикл
				
				Значение = Запись[ИзмерениеРегистра.Ключ];
				
				Если ТипЗнч(Значение) = Тип("Структура") Тогда
					
						
				Если ИзмерениеРегистра.Ключ = "Номенклатура" Тогда
					ПКО = Справочник_Номенклатура_Получение;      
				ИначеЕсли ИзмерениеРегистра.Ключ = "Склад" Тогда
		            ПКО = Справочник_Склады_Получение;
		        Иначе
		             ПКО = Справочник_Пользователи;	
				КонецЕсли;
					
					Значение = RM_ОбменДаннымиXDTOСервер.СтруктураОбъектаXDTOВДанныеИБ(КомпонентыОбмена, 
						Значение, 
						ПКО, 
						"ПолучитьСсылку").Ссылка;	
					
				КонецЕсли;
					
					
				СтрокаЗаписи[ИзмерениеРегистра.Ключ] = Значение;
		 		
	
			КонецЦикла;			
	
				
		КонецЦикла;
		
	КонецЕсли;
КонецПроцедуры
