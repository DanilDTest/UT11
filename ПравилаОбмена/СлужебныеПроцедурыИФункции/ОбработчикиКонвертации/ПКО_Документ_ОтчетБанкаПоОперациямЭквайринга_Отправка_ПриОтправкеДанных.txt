Процедура ПКО_Документ_ОтчетБанкаПоОперациямЭквайринга_Отправка_ПриОтправкеДанных(ДанныеИБ, ДанныеXDTO, КомпонентыОбмена, СтекВыгрузки)
	Если СтекВыгрузки.Количество() > 1 Тогда
		Возврат;
	КонецЕсли;
	
	// Обход ошибки формата.
	Если ДанныеИБ.СуммаДокумента = 0 Тогда
		ДанныеXDTO.Вставить("Сумма", -1);
	КонецЕсли;
	
	ВыгрузитьПодразделениеИзРеквизитаДокумента(КомпонентыОбмена, ДанныеИБ, ДанныеXDTO, "БанковскийСчет");
	ВыгрузитьДополнительныеРеквизитыИСведения(КомпонентыОбмена, ДанныеИБ, ДанныеXDTO);
	
	//ТабличныеЧасти
	Запрос = Новый Запрос("ВЫБРАТЬ
		|ДатаПлатежа,
		|"""" КАК ВидКарты,
		|НомерПлатежнойКарты КАК НомерКарты,
		|Сумма
		|ИЗ Документ.ОтчетБанкаПоОперациямЭквайринга.Покупки
		|ГДЕ Ссылка = &Ссылка
		|;
		|ВЫБРАТЬ
		|ДатаПлатежа,
		|"""" КАК ВидКарты,
		|НомерПлатежнойКарты КАК НомерКарты,
		|Сумма
		|ИЗ Документ.ОтчетБанкаПоОперациямЭквайринга.Возвраты
		|ГДЕ Ссылка = &Ссылка
		|");
	
	Запрос.УстановитьПараметр("Ссылка", ДанныеИБ.Ссылка);
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	
	ДанныеXDTO.Вставить("Покупки",  РезультатЗапроса[0].Выгрузить());
	ДанныеXDTO.Вставить("Возвраты", РезультатЗапроса[1].Выгрузить());
КонецПроцедуры
