Процедура ПОД_Документ_КассоваяСмена_Отправка_ПриОбработке(ДанныеИБ, ИспользованиеПКО, КомпонентыОбмена)
	Если ВерсияФорматаЧислом(КомпонентыОбмена.ВерсияФорматаОбмена) < ВерсияФорматаЧислом("1.4") Тогда
		ИспользованиеПКО.Очистить();
		Возврат;
	КонецЕсли;
	
	//Получим КассуККМ
	КассаККМ = ДанныеИБ.КассаККМ;
	Если Не ЗначениеЗаполнено(КассаККМ) Тогда
		
		КассаККМФискальноеУстройство = КассаККМФискальноеУстройство(ДанныеИБ.ФискальноеУстройство);
		КассаККМ = КассаККМФискальноеУстройство.КассаККМ;
		
		Если Не ЗначениеЗаполнено(КассаККМ) Тогда
			
			ИспользованиеПКО.Очистить();
			
			ШаблонПредупреждения = НСтр("ru = 'Документ %1 не может быть выгружен,
			|т.к. не обнаружена КассаККМ, соответствующая оборудованию: 
			|%2';
			|en = 'Document %1 cannot be exported
			|as КассаККМ corresponding to peripherals was not found: 
			|%2'");
			
			ТекстПредупреждения = СтрШаблон(ШаблонПредупреждения, ДанныеИБ.Ссылка, ДанныеИБ.ФискальноеУстройство);
			ПредупреждениеПриСинхронизации(КомпонентыОбмена, ДанныеИБ.Ссылка, ТекстПредупреждения);
			
			Возврат;
		КонецЕсли;
	КонецЕсли;
	
	ДанныеИБ.ДополнительныеСвойства.Вставить("КассаККМ", КассаККМ);
	
	Если ДанныеИБ.Статус = Перечисления.СтатусыКассовойСмены.Открыта Тогда
		ИспользованиеПКО.Документ_КассоваяСменаЗакрытие_Отправка = Ложь;
	КонецЕсли;
КонецПроцедуры
