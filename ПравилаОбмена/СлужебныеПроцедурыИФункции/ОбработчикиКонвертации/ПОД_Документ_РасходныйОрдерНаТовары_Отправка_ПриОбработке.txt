Процедура ПОД_Документ_РасходныйОрдерНаТовары_Отправка_ПриОбработке(ДанныеИБ, ИспользованиеПКО, КомпонентыОбмена)
	УстановитьИспользованиеПКО(ИспользованиеПКО, Ложь);
	Если ДанныеИБ.ПометкаУдаления Тогда
		Возврат;
	КонецЕсли;     
	
	ТекстЗапроса =             
	"ВЫБРАТЬ
	|	РасходныйОрдерНаТоварыОтгружаемыеТовары.Ссылка КАК Ссылка,
	|	РасходныйОрдерНаТоварыОтгружаемыеТовары.НомерСтроки КАК НомерСтроки,
	|	РасходныйОрдерНаТоварыОтгружаемыеТовары.Номенклатура КАК Номенклатура,
	|	РасходныйОрдерНаТоварыОтгружаемыеТовары.Характеристика КАК Характеристика,
	|	РасходныйОрдерНаТоварыОтгружаемыеТовары.Серия КАК Серия,
	|	РасходныйОрдерНаТоварыОтгружаемыеТовары.СтатусУказанияСерий КАК СтатусУказанияСерий,
	|	РасходныйОрдерНаТоварыОтгружаемыеТовары.Количество КАК Количество,
	|	ВЫБОР
	|		КОГДА РасходныйОрдерНаТоварыОтгружаемыеТовары.Упаковка.Числитель > 1
	|			ТОГДА РасходныйОрдерНаТоварыОтгружаемыеТовары.Количество
	|		ИНАЧЕ РасходныйОрдерНаТоварыОтгружаемыеТовары.КоличествоУпаковок
	|	КОНЕЦ КАК КоличествоУпаковок,
	|	ВЫБОР
	|		КОГДА РасходныйОрдерНаТоварыОтгружаемыеТовары.Упаковка.Числитель > 1
	|			ТОГДА РасходныйОрдерНаТоварыОтгружаемыеТовары.Упаковка.Родитель
	|		ИНАЧЕ РасходныйОрдерНаТоварыОтгружаемыеТовары.Упаковка
	|	КОНЕЦ КАК Упаковка
	|ИЗ
	|	Документ.РасходныйОрдерНаТовары.ОтгружаемыеТовары КАК РасходныйОрдерНаТоварыОтгружаемыеТовары
	|ГДЕ
	|	РасходныйОрдерНаТоварыОтгружаемыеТовары.Ссылка = &Ссылка 
	|   И НЕ РасходныйОрдерНаТоварыОтгружаемыеТовары.ЭтоУпаковочныйЛист
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РасходныйОрдерНаТоварыRM_ШтрихкодыУпаковок.Ссылка КАК Ссылка,
	|	РасходныйОрдерНаТоварыRM_ШтрихкодыУпаковок.НомерСтроки КАК НомерСтрокиДокумента,
	|	РасходныйОрдерНаТоварыRM_ШтрихкодыУпаковок.ШтрихкодУпаковки КАК ШтрихкодУпаковки,
	|	ЕСТЬNULL(РасходныйОрдерНаТоварыRM_ШтрихкодыУпаковок.ШтрихкодУпаковки.ЗначениеШтрихкода, """") КАК НомерАкцизнойМарки
	|ИЗ
	|	Документ.РасходныйОрдерНаТовары.RM_ШтрихкодыУпаковок КАК РасходныйОрдерНаТоварыRM_ШтрихкодыУпаковок
	|ГДЕ
	|	РасходныйОрдерНаТоварыRM_ШтрихкодыУпаковок.Ссылка = &Ссылка
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтрокиДокумента";
	
	Запрос = Новый Запрос;
	Запрос.Текст = ТекстЗапроса;
	
	Запрос.Параметры.Вставить("Ссылка", ДанныеИБ.Ссылка);
	РезультатЗапроса = Запрос.ВыполнитьПакет();            
	
	Товары = РезультатЗапроса[РезультатЗапроса.ВГраница() - 1].Выгрузить();   
	Если Товары.Количество() = 0 Тогда
		Возврат;   
	Иначе
		ИспользованиеПКО.Документ_РасходныйОрдерНаТовары_Отправка = Истина;
	КонецЕсли;
	
	ШтрихкодыУпаковок = РезультатЗапроса[РезультатЗапроса.ВГраница()].Выгрузить();    
	
	ДанныеИБ.ДополнительныеСвойства.Вставить("Товары", Товары);
	ДанныеИБ.ДополнительныеСвойства.Вставить("ШтрихкодыУпаковок", ШтрихкодыУпаковок);
КонецПроцедуры
