Процедура ПКО_Документ_ПересчетТоваров_Получение_ПриКонвертацииДанныхXDTO(ДанныеXDTO, ПолученныеДанные, КомпонентыОбмена)
	#Область Товары
	Если ДанныеXDTO.Свойство("Товары") 
		И ЗначениеЗаполнено(ДанныеXDTO.Товары) Тогда
		ПравилаЗаполнения = Новый Соответствие;
		ПравилаЗаполнения.Вставить("Номенклатура",   "Номенклатура");
		ПравилаЗаполнения.Вставить("Количество",     "Количество");
		ПравилаЗаполнения.Вставить("КоличествоФакт", "КоличествоФакт");
		Если ЗначениеФО("ИспользоватьХарактеристикиНоменклатуры", КомпонентыОбмена) Тогда
			ПравилаЗаполнения.Вставить("Характеристика",         "Характеристика");
		КонецЕсли;
		Если ЗначениеФО("ИспользоватьУпаковкиНоменклатуры", КомпонентыОбмена) Тогда
			ПравилаЗаполнения.Вставить("Упаковка",               "Упаковка");
			ПравилаЗаполнения.Вставить("КоличествоУпаковок",     "КоличествоУпаковок");
			ПравилаЗаполнения.Вставить("КоличествоУпаковокФакт", "КоличествоУпаковокФакт");
		КонецЕсли;
		Если ЗначениеФО("ИспользоватьСерииНоменклатуры", КомпонентыОбмена) Тогда
			ПравилаЗаполнения.Вставить("Серия",                  "Серия");
		КонецЕсли;
		
		МассивСтрокТовары = Новый Массив;
		Для Каждого Строка Из ДанныеXDTO.Товары Цикл
			
			СтруктураДанныхСтроки = ДанныеКоллекцииВВидеСтруктуры(Строка, ПравилаЗаполнения);
			
			Если СтруктураДанныхСтроки.Свойство("Количество") И НЕ СтруктураДанныхСтроки.Свойство("КоличествоУпаковок") Тогда
				СтруктураДанныхСтроки.Вставить("КоличествоУпаковок", СтруктураДанныхСтроки.Количество);
			КонецЕсли;
			Если СтруктураДанныхСтроки.Свойство("КоличествоФакт") И НЕ СтруктураДанныхСтроки.Свойство("КоличествоУпаковокФакт") Тогда
				СтруктураДанныхСтроки.Вставить("КоличествоУпаковокФакт", СтруктураДанныхСтроки.КоличествоФакт);
			КонецЕсли;	
			
			МассивСтрокТовары.Добавить(СтруктураДанныхСтроки);
			
		КонецЦикла;
		
		ПолученныеДанные.ДополнительныеСвойства.Вставить("Товары", МассивСтрокТовары);
	КонецЕсли;
		
	#КонецОбласти
		
	ЗагрузитьДополнительныеРеквизиты(ПолученныеДанные, ДанныеXDTO, КомпонентыОбмена);
КонецПроцедуры
