Процедура ПКО_Спр_RM_ИсторияСтатусовПриемкиВозвратовОтКС_Получен_ПередЗаписьюПолученныхДанных(ПолученныеДанные, ДанныеИБ, КонвертацияСвойств, КомпонентыОбмена)
	Документ_RM_ПриемкаВозвратовОтКС_Получение = RM_ОбменДаннымиXDTOСервер.ПКОПоИмени(КомпонентыОбмена, "Документ_RM_ПриемкаВозвратовОтКС_Получение");
	Справочник_Пользователи = RM_ОбменДаннымиXDTOСервер.ПКОПоИмени(КомпонентыОбмена,"Справочник_Пользователи");   
	Перечисление_RM_СтатусыПриемкиВозвратовОтКС = КомпонентыОбмена.ПравилаКонвертацииПредопределенныхДанных.Найти("Перечисление_RM_СтатусыПриемкиВозвратовОтКС", "ИмяПКПД");
	
	
	СтруктураИзмеренийРегистра = Новый Структура;
	СтруктураИзмеренийРегистра.Вставить("ПриемкаВозвратовОтКС");
	СтруктураИзмеренийРегистра.Вставить("Период");
	
	
	Для каждого ИзмерениеРегистра из СтруктураИзмеренийРегистра Цикл
		Значение = ПолученныеДанные.ДополнительныеСвойства[ИзмерениеРегистра.Ключ];
		
		Если Значение = Неопределено Тогда
			Продолжить;
		ИначеЕсли ТипЗнч(Значение) = Тип("Структура") Тогда
			
			Если ИзмерениеРегистра.Ключ = "ПриемкаВозвратовОтКС" Тогда
				ПКО = Документ_RM_ПриемкаВозвратовОтКС_Получение;
			КонецЕсли;
			
			Значение = RM_ОбменДаннымиXDTOСервер.СтруктураОбъектаXDTOВДанныеИБ(КомпонентыОбмена, 
				Значение, 
				ПКО, 
				"ПолучитьСсылку").Ссылка;		
		КонецЕсли;
	
		 ПолученныеДанные.Отбор[ИзмерениеРегистра.Ключ].Значение = Значение;
		 ПолученныеДанные.Отбор[ИзмерениеРегистра.Ключ].Использование = Истина;
	КонецЦикла;
	       
	СтруктураСсылочныхПолей = СтруктураИзмеренийРегистра; 
	СтруктураСсылочныхПолей.Вставить("Ответственный");
	СтруктураСсылочныхПолей.Вставить("ДокументРегистратор");       
		
	// Добавление записей в набор записей.		
	Если ПолученныеДанные.ДополнительныеСвойства.Записи <> Неопределено Тогда
		
		Для Каждого Запись Из ПолученныеДанные.ДополнительныеСвойства.Записи Цикл
			
			СтрокаЗаписи          = ПолученныеДанные.Добавить();
			СтрокаЗаписи.Период			= Запись.Период;    
			СтрокаЗаписи.Статус			= Перечисление_RM_СтатусыПриемкиВозвратовОтКС.КонвертацииЗначенийПриПолучении.Получить(Запись.Статус.Значение);
			СтрокаЗаписи.Комментарий	= Запись.Комментарий;
					
			Для Каждого ИзмерениеРегистра из СтруктураСсылочныхПолей Цикл
				
				Значение = Запись[ИзмерениеРегистра.Ключ];
				
				Если ТипЗнч(Значение) = Тип("Структура") Тогда
					
					Если ИзмерениеРегистра.Ключ = "ПриемкаВозвратовОтКС" Тогда
						ПКО = Документ_RM_ПриемкаВозвратовОтКС_Получение;
					ИначеЕсли ИзмерениеРегистра.Ключ = "ДокументРегистратор" Тогда
						ПКО = Документ_RM_ПриемкаВозвратовОтКС_Получение;
					ИначеЕсли ИзмерениеРегистра.Ключ = "Ответственный" Тогда
						ПКО = Справочник_Пользователи;
					КонецЕсли;
					
					Значение = RM_ОбменДаннымиXDTOСервер.СтруктураОбъектаXDTOВДанныеИБ(КомпонентыОбмена, 
						Значение, 
						ПКО, 
						"ПолучитьСсылку").Ссылка;	
					
				КонецЕсли;
					
				СтрокаЗаписи[ИзмерениеРегистра.Ключ] = Значение;
	
			КонецЦикла;			
				
		КонецЦикла;
		
	КонецЕсли;
КонецПроцедуры
