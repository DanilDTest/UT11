Процедура ПКО_Спр_ИсторияСтатусовИнтернетЗаказов_Получение_ПередЗаписьюПолученныхДанных(ПолученныеДанные, ДанныеИБ, КонвертацияСвойств, КомпонентыОбмена)
	Документ_ЗаказКлиента_Получение = RM_ОбменДаннымиXDTOСервер.ПКОПоИмени(КомпонентыОбмена,"Документ_ЗаказКлиента_Получение");
	Справочник_Пользователи = RM_ОбменДаннымиXDTOСервер.ПКОПоИмени(КомпонентыОбмена,"Справочник_Пользователи");
	
	СтруктураИзмеренийРегистра = Новый Структура;
	СтруктураИзмеренийРегистра.Вставить("ЗаказКлиента");
	СтруктураИзмеренийРегистра.Вставить("Период");
	
	
	Для каждого ИзмерениеРегистра из СтруктураИзмеренийРегистра Цикл
		Значение = ПолученныеДанные.ДополнительныеСвойства[ИзмерениеРегистра.Ключ];
		
		Если Значение = Неопределено Тогда
			Продолжить;
		ИначеЕсли ТипЗнч(Значение) = Тип("Структура") Тогда
			
			Если ИзмерениеРегистра.Ключ = "ЗаказКлиента" Тогда
				ПКО = Документ_ЗаказКлиента_Получение;
			КонецЕсли;
			
			Значение = RM_ОбменДаннымиXDTOСервер.СтруктураОбъектаXDTOВДанныеИБ(КомпонентыОбмена, 
				Значение, 
				ПКО, 
				"ПолучитьСсылку").Ссылка;		
		КонецЕсли;
	
		 ПолученныеДанные.Отбор[ИзмерениеРегистра.Ключ].Значение = Значение;
		 ПолученныеДанные.Отбор[ИзмерениеРегистра.Ключ].Использование = Истина;
	КонецЦикла;
	       
	СтруктураСсылочныхПолей = СтруктураИзмеренийРегистра;
	СтруктураСсылочныхПолей.Вставить("Ответственный");       
		
	// Добавление записей в набор записей.		
	Если ПолученныеДанные.ДополнительныеСвойства.Записи <> Неопределено Тогда
		
		Для Каждого Запись Из ПолученныеДанные.ДополнительныеСвойства.Записи Цикл
			
			СтрокаЗаписи          = ПолученныеДанные.Добавить();
			СтрокаЗаписи.Статус = ЗначениеПеречисленияПоСинониму("RM_СтатусыИнтернетЗаказов" , Запись.Статус);
			СтрокаЗаписи.Период = Запись.Период;    
			СтрокаЗаписи.МестноеВремя = Запись.МестноеВремя;
	
					
			Для каждого ИзмерениеРегистра из СтруктураСсылочныхПолей Цикл
				
				Значение = Запись[ИзмерениеРегистра.Ключ];
				
				Если ТипЗнч(Значение) = Тип("Структура") Тогда
					
					Если ИзмерениеРегистра.Ключ = "ЗаказКлиента" Тогда
						ПКО = Документ_ЗаказКлиента_Получение;
					ИначеЕсли ИзмерениеРегистра.Ключ = "Ответственный" Тогда
						ПКО = Справочник_Пользователи;
					КонецЕсли;
					
					Значение = RM_ОбменДаннымиXDTOСервер.СтруктураОбъектаXDTOВДанныеИБ(КомпонентыОбмена, 
						Значение, 
						ПКО, 
						"ПолучитьСсылку").Ссылка;	
					
				КонецЕсли;
					
					
				СтрокаЗаписи[ИзмерениеРегистра.Ключ] = Значение;
		 		
	
			КонецЦикла;			
	
				
		КонецЦикла;
		
	КонецЕсли;
КонецПроцедуры
