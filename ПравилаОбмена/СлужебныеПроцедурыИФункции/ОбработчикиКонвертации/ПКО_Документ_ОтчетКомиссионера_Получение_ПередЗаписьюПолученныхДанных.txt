Процедура ПКО_Документ_ОтчетКомиссионера_Получение_ПередЗаписьюПолученныхДанных(ПолученныеДанные, ДанныеИБ, КонвертацияСвойств, КомпонентыОбмена)
	ДанныеДляЗаписиВИБ = ?(ДанныеИБ = Неопределено, ПолученныеДанные, ДанныеИБ);
	Для Каждого Строка Из ДанныеДляЗаписиВИБ.Товары Цикл
		Если НЕ ЗначениеЗаполнено(Строка.СтавкаНДС) Тогда
			Если ДанныеДляЗаписиВИБ.Дата >= Дата("20190101") Тогда
			    Строка.СтавкаНДС = Перечисления.СтавкиНДС.НДС20;
			Иначе
				Строка.СтавкаНДС = Перечисления.СтавкиНДС.НДС18;
			КонецЕсли;
		КонецЕсли;  
	КонецЦикла;
	
	Если ДанныеИБ = Неопределено Тогда
		Возврат;
	КонецЕсли;
	// Переносим те свойства, которые указаны в ПКС
	ЗаполнитьСвойстваШапкиОбъекта(КонвертацияСвойств, ПолученныеДанные, ДанныеИБ);
	
	// Товары
	МассивКлючевыхПолей = Новый Массив;
	МассивКлючевыхПолей.Добавить("Номенклатура");
	МассивКлючевыхПолей.Добавить("Характеристика");
	МассивКлючевыхПолей.Добавить("СтавкаНДС");
	
	RM_ОбменДаннымиXDTOСервер.ЗаполнитьТабличнуюЧастьОбъектаНачальнымиДанными(
		ПолученныеДанные.Товары,
		ДанныеИБ.Товары,
		МассивКлючевыхПолей,
		Неопределено,
		"Количество, Упаковка, КоличествоУпаковок, Цена, Сумма, СуммаНДС, СуммаПродажи, СуммаВознаграждения, СуммаНДСВознаграждения, ЦенаПродажи"
		+ ", ДатаСчетаФактурыКомиссионера, НомерСчетаФактурыКомиссионера, Покупатель");
	ДанныеИБ.Товары.Загрузить(ПолученныеДанные.Товары.Выгрузить());
	
	ПолученныеДанные = Неопределено;
КонецПроцедуры
