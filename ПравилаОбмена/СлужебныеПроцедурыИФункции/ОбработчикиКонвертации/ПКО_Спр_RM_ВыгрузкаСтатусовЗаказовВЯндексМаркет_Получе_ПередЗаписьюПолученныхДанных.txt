Процедура ПКО_Спр_RM_ВыгрузкаСтатусовЗаказовВЯндексМаркет_Получе_ПередЗаписьюПолученныхДанных(ПолученныеДанные, ДанныеИБ, КонвертацияСвойств, КомпонентыОбмена)
	Документ_ЗаказКлиента_Получение = RM_ОбменДаннымиXDTOСервер.ПКОПоИмени(КомпонентыОбмена,"Документ_ЗаказКлиента_Получение");
	Перечисления_СтатусыОтправленийOZON = КомпонентыОбмена.ПравилаКонвертацииПредопределенныхДанных.Найти("Перечисление_RM_СтатусыОтправленийOZON", "ИмяПКПД");
	
	
	СтруктураИзмеренийРегистра = Новый Структура;
	СтруктураИзмеренийРегистра.Вставить("НомерЗаказа");
	СтруктураИзмеренийРегистра.Вставить("Период");
	
	
	Для Каждого ИзмерениеРегистра из СтруктураИзмеренийРегистра Цикл
		Значение = ПолученныеДанные.ДополнительныеСвойства[ИзмерениеРегистра.Ключ];
		
		Если Значение = Неопределено Тогда
			Продолжить;
		ИначеЕсли ТипЗнч(Значение) = Тип("Структура") Тогда
			
			Если ИзмерениеРегистра.Ключ = "ЗаказКлиента" Тогда
				ПКО = Документ_ЗаказКлиента_Получение;
			КонецЕсли;
			
			Значение = RM_ОбменДаннымиXDTOСервер.СтруктураОбъектаXDTOВДанныеИБ(КомпонентыОбмена, 
				Значение, 
				ПКО, 
				"ПолучитьСсылку").Ссылка;		
		КонецЕсли;
	
		 ПолученныеДанные.Отбор[ИзмерениеРегистра.Ключ].Значение = Значение;
		 ПолученныеДанные.Отбор[ИзмерениеРегистра.Ключ].Использование = Истина;
	КонецЦикла;
	       
	СтруктураСсылочныхПолей = Новый Структура;
	СтруктураСсылочныхПолей.Вставить("ЗаказКлиента");
		
	// Добавление записей в набор записей.		
	Если ПолученныеДанные.ДополнительныеСвойства.Записи <> Неопределено Тогда
		
		Для Каждого Запись Из ПолученныеДанные.ДополнительныеСвойства.Записи Цикл
			
			СтрокаЗаписи				= ПолученныеДанные.Добавить();
			СтрокаЗаписи.Период			= Запись.Период;  
			СтрокаЗаписи.НомерЗаказа	= Запись.НомерЗаказа;   
			СтрокаЗаписи.Статус			= Перечисления_СтатусыОтправленийOZON.КонвертацииЗначенийПриПолучении.Получить(Запись.Статус.Значение); 
			СтрокаЗаписи.Отправлено		= Запись.Отправлено;
			СтрокаЗаписи.Ошибка			= Запись.Ошибка;
			СтрокаЗаписи.Ответ			= Запись.Ответ;
					
			Для Каждого ИзмерениеРегистра из СтруктураСсылочныхПолей Цикл
				
				Значение = Запись[ИзмерениеРегистра.Ключ];
				
				Если ТипЗнч(Значение) = Тип("Структура") Тогда
					
					Если ИзмерениеРегистра.Ключ = "ЗаказКлиента" Тогда
						ПКО = Документ_ЗаказКлиента_Получение;
					КонецЕсли;
					
					Значение = RM_ОбменДаннымиXDTOСервер.СтруктураОбъектаXDTOВДанныеИБ(КомпонентыОбмена, 
						Значение, 
						ПКО, 
						"ПолучитьСсылку").Ссылка;	
					
				КонецЕсли;
					
				СтрокаЗаписи[ИзмерениеРегистра.Ключ] = Значение;
	
			КонецЦикла;
						
		КонецЦикла;
		
	КонецЕсли;
КонецПроцедуры
