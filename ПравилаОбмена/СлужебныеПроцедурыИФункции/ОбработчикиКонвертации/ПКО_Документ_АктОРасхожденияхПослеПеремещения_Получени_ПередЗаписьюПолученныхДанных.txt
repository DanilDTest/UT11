Процедура ПКО_Документ_АктОРасхожденияхПослеПеремещения_Получени_ПередЗаписьюПолученныхДанных(ПолученныеДанные, ДанныеИБ, КонвертацияСвойств, КомпонентыОбмена)
	ЭтоНовый = Истина; 
		Проведен = ПолученныеДанные.Проведен;
		Если ДанныеИБ <> Неопределено Тогда     
		  	 
		//Если СтрНайти(КомпонентыОбмена.ПараметрыКонвертации.КодУзлаОтправителя, КомпонентыОбмена.ПараметрыКонвертации.КодУзлаWMSСкладыРоссия) = 0 Тогда
			// Восстанавливаем "затертые" данные
			//Товары
			МассивКлючевыхПолей = Новый Массив;
			МассивКлючевыхПолей.Добавить("Номенклатура");
			МассивКлючевыхПолей.Добавить("Упаковка");
			МассивКлючевыхПолей.Добавить("КоличествоУпаковок");
			МассивКлючевыхПолей.Добавить("КоличествоУпаковокПоДокументу");
	         
	        RM_ОбменДаннымиXDTOСервер.ЗаполнитьТабличнуюЧастьОбъектаНачальнымиДанными(
					ПолученныеДанные.Товары,
					ДанныеИБ.Товары,
					МассивКлючевыхПолей,
					"RM_СтатусОшибки, RM_ДатаРезолюции");       
		//КонецЕсли;
				
			// Переносим те свойства, которые указаны в ПКС.
			ЗаполнитьСвойстваШапкиОбъекта(КонвертацияСвойств, ПолученныеДанные, ДанныеИБ);
			
			// Табличные части
			ДанныеИБ.Товары.Загрузить(ПолученныеДанные.Товары.Выгрузить());
			ДанныеИБ.RM_ШтрихкодыУпаковок.Загрузить(ПолученныеДанные.RM_ШтрихкодыУпаковок.Выгрузить());
			
			ЭтоНовый = Ложь;
			ПолученныеДанные = Неопределено;
			
		КонецЕсли;
		
		
		ДанныеДляЗаписиВИБ = ?(ДанныеИБ = Неопределено, ПолученныеДанные, ДанныеИБ);  
		РежимЗаписи = ?(Проведен, РежимЗаписиДокумента.Проведение, РежимЗаписиДокумента.Запись); 
		
		
		ПравилаПроверкиМодифицированности = Документы.АктОРасхожденияхПослеПеремещения.RM_ПравилаПроверкиМодифицированности(); 
		ОбъектМодифицирован = RM_ОбщийМодуль.ОбъектМодифицирован(ДанныеДляЗаписиВИБ, ПравилаПроверкиМодифицированности, РежимЗаписи); 
		
		ДанныеДляЗаписиВИБ.ДополнительныеСвойства.Вставить("ОбъектМодифицирован", ОбъектМодифицирован); 
		ДанныеДляЗаписиВИБ.ДополнительныеСвойства.Вставить("ЭтоНовый", ЭтоНовый); 
		ДанныеДляЗаписиВИБ.ОбменДанными.Загрузка = Истина; 
		
		РегистрыСведений.RM_СостояниеОтработкиНесоответствий.ЗафиксироватьСостояниеОбъекта(ДанныеДляЗаписиВИБ);
КонецПроцедуры
