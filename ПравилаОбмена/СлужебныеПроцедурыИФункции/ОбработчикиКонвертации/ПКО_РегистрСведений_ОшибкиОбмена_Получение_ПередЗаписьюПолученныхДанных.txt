Процедура ПКО_РегистрСведений_ОшибкиОбмена_Получение_ПередЗаписьюПолученныхДанных(ПолученныеДанные, ДанныеИБ, КонвертацияСвойств, КомпонентыОбмена)
	Справочник_RM_УзлыОбмена = RM_ОбменДаннымиXDTOСервер.ПКОПоИмени(КомпонентыОбмена,"Справочник_RM_УзлыОбмена");
		
		Для каждого Свойство Из ПолученныеДанные.ДополнительныеСвойства Цикл
			Если Свойство.Ключ = "Записи" Тогда
				Продолжить;
			КонецЕсли;
			
			
			Если ЗначениеЗаполнено(Свойство.Значение) Тогда
				Если Свойство.Ключ <> "УниверсальнаяДатаОшибки" Тогда
					
					КопияСтруктуры = Новый Структура;
					Для Каждого ЭлементСтруктуры Из Свойство.Значение Цикл
						КопияСтруктуры.Вставить(ЭлементСтруктуры.Ключ, ЭлементСтруктуры.Значение);
					КонецЦикла;
								
					ПолученныеДанные.Отбор[Свойство.Ключ].Установить(RM_ОбменДаннымиXDTOСервер.СтруктураОбъектаXDTOВДанныеИБ(КомпонентыОбмена, 
						КопияСтруктуры, 
						Справочник_RM_УзлыОбмена, 
						"ПолучитьСсылку").Ссылка);
					
				Иначе 
					ПолученныеДанные.Отбор[Свойство.Ключ].Установить(Свойство.Значение);
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;
			
		// Добавление записей в набор записей.		
		Если ПолученныеДанные.ДополнительныеСвойства.Записи <> Неопределено Тогда
			Для Каждого Строка Из ПолученныеДанные.ДополнительныеСвойства.Записи Цикл
				СтрокаЗаписи = ПолученныеДанные.Добавить();
				СтрокаЗаписи.УниверсальнаяДатаОшибки = Строка.УниверсальнаяДатаОшибки;
				СтрокаЗаписи.ПредставлениеОшибки = Строка.ПредставлениеОшибки;
				СтрокаЗаписи.ПредставлениеИсточника = Строка.ПредставлениеИсточника;
				
				
				СтрокаЗаписи.БазаВозникновенияОшибки = ПолученныеДанные.Отбор.БазаВозникновенияОшибки.Значение;	
				СтрокаЗаписи.БазаИсточникСообщения = ПолученныеДанные.Отбор.БазаИсточникСообщения.Значение;	
				
				Если НЕ ПустаяСтрока(Строка.ИсходящееСообщение) Тогда
				//И КомпонентыОбмена.ТекущийУзел = СтрокаЗаписи.БазаИсточникСообщения 
				    СтрокаЗаписи.ИсходящееСообщение = Справочники.RM_ИсходящиеСообщения.ПолучитьСсылку(Новый УникальныйИдентификатор(Строка.ИсходящееСообщение));
				КонецЕсли;			
		
					
				КонецЦикла;
		КонецЕсли;
КонецПроцедуры
