Процедура ПКО_Документ_ОперацияПоПлатежнойКарте_Получение_ПриКонвертацииДанныхXDTO(ДанныеXDTO, ПолученныеДанные, КомпонентыОбмена)
	ДобавитьВалютуВДопСвойства(ПолученныеДанные, ДанныеXDTO);
	ЗагрузитьДополнительныеРеквизиты(ПолученныеДанные, ДанныеXDTO, КомпонентыОбмена);
	
	ПолученныеДанные.НомерПлатежнойКарты = "0";
	ПолученныеДанные.СтатьяДвиженияДенежныхСредств = Справочники.СтатьиДвиженияДенежныхСредств.ПоступлениеОплатыОтКлиента; 
	ПолученныеДанные.Контрагент = Справочники.Контрагенты.РозничныйПокупатель;
	
	
	
	Партнер = Справочники.Партнеры.НеизвестныйПартнер;
	Если ЗначениеЗаполнено(ПолученныеДанные.Контрагент) Тогда
		Партнер = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(ПолученныеДанные.Контрагент, "Партнер");
		Если НЕ ЗначениеЗаполнено(Партнер) Тогда
			Партнер = Справочники.Партнеры.НеизвестныйПартнер;
		КонецЕсли;	
	КонецЕсли;
	        
	        
	
	Если ДанныеXDTO.Свойство("РасшифровкаПлатежа") 
		И ЗначениеЗаполнено(ДанныеXDTO.РасшифровкаПлатежа) Тогда
		// Расшифровка платежа
		МассивСтрокРасшифровкаПлатежа = Новый Массив;
		ПравилаЗаполнения = Новый Соответствие;
		ПравилаЗаполнения.Вставить("Сумма", "Сумма");
		ПравилаЗаполнения.Вставить("СуммаВзаиморасчетов", "СуммаВзаиморасчетов");
		ПравилаЗаполнения.Вставить("СтатьяДвиженияДенежныхСредств", "СтатьяДДС");
		ПравилаЗаполнения.Вставить("СтавкаНДС", "СтавкаНДС");
		ПравилаЗаполнения.Вставить("СуммаНДС", "СуммаНДС");
		ПравилаЗаполнения.Вставить("СуммаНДС", "СуммаНДС");
	
	
		Для Каждого СтрокаXDTO Из ДанныеXDTO.РасшифровкаПлатежа Цикл
			СтруктураДанныхСтроки = Новый Структура;
			ЗаполнитьСтруктуруДанныхСтроки(ПравилаЗаполнения, СтрокаXDTO, СтруктураДанныхСтроки);
			ДобавитьВалютуВРасшифровкуПлатежа(СтруктураДанныхСтроки, СтрокаXDTO);
			СтруктураДанныхСтроки.Вставить("Партнер", Партнер);
				
			ИнструкцияЗаказ = Неопределено;
			Если ЗначениеЗаполнено(СтрокаXDTO.ДокументРасчетов) Тогда
				ИнструкцияЗаказ = ЗначениеВИнструкциюПКО(КомпонентыОбмена, СтрокаXDTO.ДокументРасчетов);
			КонецЕсли;
			Если НЕ ЗначениеЗаполнено(ИнструкцияЗаказ) И ЗначениеЗаполнено(СтрокаXDTO.Заказ) Тогда
				ИнструкцияЗаказ = ЗначениеВИнструкциюПКО(КомпонентыОбмена, СтрокаXDTO.Заказ);
			КонецЕсли; 
			Если ЗначениеЗаполнено(ИнструкцияЗаказ) Тогда
			    СтруктураДанныхСтроки.Вставить("Заказ", ИнструкцияЗаказ);	
			    СтруктураДанныхСтроки.Вставить("ДокументРасчетов",    ИнструкцияЗаказ);
			Иначе
				ДобавитьДоговорВРасшифровкуПлатежа(Истина, СтруктураДанныхСтроки, СтрокаXDTO);
			КонецЕсли;
			
			МассивСтрокРасшифровкаПлатежа.Добавить(СтруктураДанныхСтроки);
		КонецЦикла;
	
		Если МассивСтрокРасшифровкаПлатежа.Количество() > 0 Тогда
			ПолученныеДанные.ДополнительныеСвойства.Вставить("РасшифровкаПлатежа", МассивСтрокРасшифровкаПлатежа);
		КонецЕсли;   
	КонецЕсли;
КонецПроцедуры
