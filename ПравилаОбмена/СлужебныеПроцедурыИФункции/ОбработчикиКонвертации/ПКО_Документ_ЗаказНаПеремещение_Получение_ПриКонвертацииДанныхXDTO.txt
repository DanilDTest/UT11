Процедура ПКО_Документ_ЗаказНаПеремещение_Получение_ПриКонвертацииДанныхXDTO(ДанныеXDTO, ПолученныеДанные, КомпонентыОбмена)
	//ПолученныеДанные.Проведен = Истина;
	ПолученныеДанные.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПеремещениеТоваров;
	//ПолученныеДанные.Статус = Перечисления.СтатусыВнутреннихЗаказов.КВыполнению;
	#Область Товары
	
	ПравилаЗаполнения = Новый Соответствие;
	ПравилаЗаполнения.Вставить("Номенклатура", "Номенклатура");
	ПравилаЗаполнения.Вставить("Количество",   "Количество");  
	ПравилаЗаполнения.Вставить("КодСтроки",   "КодСтроки");
	ПравилаЗаполнения.Вставить("НачалоОтгрузки",   "НачалоОтгрузки");  
	ПравилаЗаполнения.Вставить("ОкончаниеПоступления",   "ОкончаниеПоступления");
	ПравилаЗаполнения.Вставить("ВариантОбеспечения",   "ВариантОбеспечения"); 
	
	ПравилаЗаполнения.Вставить("Отменено",     "Отменено");
	Если ЗначениеФО("ИспользоватьХарактеристикиНоменклатуры", КомпонентыОбмена) Тогда
		ПравилаЗаполнения.Вставить("Характеристика",     "Характеристика");
	КонецЕсли;
	Если ЗначениеФО("ИспользоватьУпаковкиНоменклатуры", КомпонентыОбмена) Тогда
		ПравилаЗаполнения.Вставить("Упаковка",           "Упаковка");
		ПравилаЗаполнения.Вставить("КоличествоУпаковок", "КоличествоУпаковок");
	КонецЕсли;
	Если ЗначениеФО("ИспользоватьСерииНоменклатуры", КомпонентыОбмена) Тогда
		ПравилаЗаполнения.Вставить("Серия",              "Серия");
	КонецЕсли;
	
	МассивСтрокТовары = Новый Массив;
	Если ДанныеXDTO.Свойство("Товары") Тогда
		Для Каждого Строка Из ДанныеXDTO.Товары Цикл
			
			СтруктураДанныхСтроки = ДанныеКоллекцииВВидеСтруктуры(Строка, ПравилаЗаполнения);
			
			Если НЕ СтруктураДанныхСтроки.Свойство("КоличествоУпаковок") Тогда
				СтруктураДанныхСтроки.Вставить("КоличествоУпаковок", СтруктураДанныхСтроки.Количество);
			КонецЕсли;	
			
			МассивСтрокТовары.Добавить(СтруктураДанныхСтроки);
			
		КонецЦикла;
	КонецЕсли;
	
	ПолученныеДанные.ДополнительныеСвойства.Вставить("Товары", МассивСтрокТовары);
	
	#КонецОбласти
	                                                                                 
	ЗаполнитьРеквизитыОбъектаПоДопРеквизитам(ДанныеXDTO, ПолученныеДанные);                                                                                  
	ЗагрузитьДополнительныеРеквизиты(ПолученныеДанные, ДанныеXDTO, КомпонентыОбмена);   
	
	Если ПолученныеДанные.СпособДоставки = Перечисления.СпособыДоставки.КПолучателюОпределяетСлужбаДоставки 
		И НЕ ЗначениеЗаполнено(ПолученныеДанные.АдресДоставки) Тогда    
		
		СтруктураКИ = Новый Структура;
	    КИСклада = УправлениеКОнтактнойИНформацией.КонтактнаяИнформацияОбъекта(ПолученныеДанные.СкладПолучатель,Справочники.ВидыКонтактнойИнформации.АдресСклада,,Ложь); 
	    Если КИСклада.Количество() > 0 Тогда   
	    	СтрокаКИ = КИСклада[0];
	   		СтруктураКИ.Вставить("АдресДоставки", СтрокаКИ.Представление);
			СтруктураКИ.Вставить("АдресДоставкиЗначенияПолей", СтрокаКИ.ЗначенияПолей);
			СтруктураКИ.Вставить("АдресДоставкиЗначение", СтрокаКИ.Значение);
	 	КонецЕсли;
	                
		ЗаполнитьЗначенияСвойств(ПолученныеДанные, СтруктураКИ);                
	                
	КонецЕсли;
КонецПроцедуры
